var f=Symbol.for("bitecs-u8"),I=Symbol.for("bitecs-i8"),d=Symbol.for("bitecs-u16"),R=Symbol.for("bitecs-i16"),A=Symbol.for("bitecs-u32"),U=Symbol.for("bitecs-i32"),v=Symbol.for("bitecs-f32"),h=Symbol.for("bitecs-f64"),S=e=>(r=[])=>Object.defineProperty(r,e,{value:!0,enumerable:!1,writable:!1,configurable:!1}),H=S(f),J=S(I),K=S(d),N=S(R),Q=S(A),X=S(U),Y=S(v),Z=S(h),T={[f]:(e,r,i)=>(e.setUint8(r,i),1),[I]:(e,r,i)=>(e.setInt8(r,i),1),[d]:(e,r,i)=>(e.setUint16(r,i),2),[R]:(e,r,i)=>(e.setInt16(r,i),2),[A]:(e,r,i)=>(e.setUint32(r,i),4),[U]:(e,r,i)=>(e.setInt32(r,i),4),[v]:(e,r,i)=>(e.setFloat32(r,i),4),[h]:(e,r,i)=>(e.setFloat64(r,i),8)},E={[f]:(e,r)=>({value:e.getUint8(r),size:1}),[I]:(e,r)=>({value:e.getInt8(r),size:1}),[d]:(e,r)=>({value:e.getUint16(r),size:2}),[R]:(e,r)=>({value:e.getInt16(r),size:2}),[A]:(e,r)=>({value:e.getUint32(r),size:4}),[U]:(e,r)=>({value:e.getInt32(r),size:4}),[v]:(e,r)=>({value:e.getFloat32(r),size:4}),[h]:(e,r)=>({value:e.getFloat64(r),size:8})};function O(e){return e&&(ArrayBuffer.isView(e)||Array.isArray(e)&&typeof e=="object")}function x(e){for(let r of[f,I,d,R,A,U,v,h])if(r in e)return r;return e instanceof Int8Array?I:e instanceof Uint8Array?f:e instanceof Int16Array?R:e instanceof Uint16Array?d:e instanceof Int32Array?U:e instanceof Uint32Array?A:e instanceof Float32Array?v:h}var _=e=>{if(O(e)){let a=x(e),y=T[a];return(t,o,l)=>{let s=0;return s+=T[A](t,o,l),s+=y(t,o+s,e[l]),s}}let r=Object.keys(e),n=r.map(a=>{let y=e[a];if(!O(y))throw new Error(`Invalid array type for property ${a}`);return x(y)}).map(a=>T[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,y,t)=>{let o=0;o+=T[A](a,y+o,t);for(let l=0;l<r.length;l++)o+=n[l](a,y+o,e[r[l]][t]);return o}},ee=e=>{if(O(e)){let a=x(e),y=E[a];return(t,o,l)=>{let s=0,{value:u,size:c}=E[A](t,o);s+=c;let m=l?l.get(u)??u:u,{value:p,size:g}=y(t,o+s);return e[m]=p,s+g}}let r=Object.keys(e),n=r.map(a=>{let y=e[a];if(!O(y))throw new Error(`Invalid array type for property ${a}`);return x(y)}).map(a=>E[a]||(()=>{throw new Error("Unsupported or unannotated type")}));return(a,y,t)=>{let o=0,{value:l,size:s}=E[A](a,y+o);o+=s;let u=t?t.get(l)??l:l;for(let c=0;c<r.length;c++){let{value:m,size:p}=n[c](a,y+o);e[r[c]][u]=m,o+=p}return o}},B=(e,r=new ArrayBuffer(1024*1024*100))=>{let i=new DataView(r),n=e.map(_);return a=>{let y=0;for(let t=0;t<a.length;t++){let o=a[t];for(let l=0;l<n.length;l++)y+=n[l](i,y,o)}return r.slice(0,y)}},F=e=>{let r=e.map(ee);return(i,n)=>{let a=new DataView(i),y=0;for(;y<i.byteLength;)for(let t=0;t<r.length;t++)y+=r[t](a,y,n)}};import{addComponent as W,hasComponent as te,getAllEntities as ne,addEntity as L,isRelation as V,getRelationTargets as re,Wildcard as ve,query as Se}from"bitecs";function ie(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y],o=t[r];o!==void 0&&(t instanceof Int8Array||I in t?(i.setInt8(n,o),n+=1):t instanceof Uint8Array||f in t?(i.setUint8(n,o),n+=1):t instanceof Int16Array||R in t?(i.setInt16(n,o),n+=2):t instanceof Uint16Array||d in t?(i.setUint16(n,o),n+=2):t instanceof Int32Array||U in t?(i.setInt32(n,o),n+=4):t instanceof Uint32Array||A in t?(i.setUint32(n,o),n+=4):t instanceof Float32Array||v in t?(i.setFloat32(n,o),n+=4):(i.setFloat64(n,o),n+=8))}}return n}function oe(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y];t instanceof Int8Array||I in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||f in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||R in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||d in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||U in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||v in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var ae=(e,r,i=new ArrayBuffer(1024*1024*100))=>{let n=new DataView(i),a=0,y=o=>{let l=o.length;n.setUint32(a,l),a+=4;for(let s=0;s<l;s++){let u=o[s],c=0;n.setUint32(a,u),a+=4;let m=a;a+=1;for(let p=0;p<r.length;p++){let g=r[p];if(V(g)){let b=re(e,u,g);for(let D of b){n.setUint8(a,p),a+=1,n.setUint32(a,D),a+=4;let z=g(D);a=ie(z,u,n,a),c++}}else te(e,u,g)&&(n.setUint8(a,p),a+=1,c++)}n.setUint8(m,c)}},t=o=>{let s=B(r,i.slice(a))(o);new Uint8Array(i).set(new Uint8Array(s),a),a+=s.byteLength};return()=>{a=0;let o=ne(e);return y(o),t(o),i.slice(0,a)}},se=(e,r,i)=>{let n=i||new Map,a=F(r);return(y,t)=>{let o=t||n,l=new DataView(y),s=0,u=l.getUint32(s);s+=4;for(let c=0;c<u;c++){let m=l.getUint32(s);s+=4;let p=o.get(m);p===void 0&&(p=L(e),o.set(m,p));let g=l.getUint8(s);s+=1;for(let b=0;b<g;b++){let D=l.getUint8(s);s+=1;let z=r[D];if(V(z)){let w=l.getUint32(s);s+=4;let $=o.get(w);$===void 0&&($=L(e),o.set(w,$));let k=z($);W(e,p,k),s=oe(k,p,l,s)}else W(e,p,z)}}return a(y.slice(s),o),o}};import{addComponent as M,removeComponent as q,addEntity as ye,removeEntity as le,observe as C,onAdd as P,onRemove as j,entityExists as ue,isRelation as ce,getRelationTargets as pe,Wildcard as G}from"bitecs";function me(e,r,i,n){if(!e)return n;if(Array.isArray(e)){let a=e[r];return a!==void 0?(i.setFloat64(n,a),n+8):n}if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y],o=t[r];o!==void 0&&(t instanceof Int8Array||I in t?(i.setInt8(n,o),n+=1):t instanceof Uint8Array||f in t?(i.setUint8(n,o),n+=1):t instanceof Int16Array||R in t?(i.setInt16(n,o),n+=2):t instanceof Uint16Array||d in t?(i.setUint16(n,o),n+=2):t instanceof Int32Array||U in t?(i.setInt32(n,o),n+=4):t instanceof Uint32Array||A in t?(i.setUint32(n,o),n+=4):t instanceof Float32Array||v in t?(i.setFloat32(n,o),n+=4):(i.setFloat64(n,o),n+=8))}}return n}function be(e,r,i,n){if(!e)return n;if(Array.isArray(e))return e[r]=i.getFloat64(n),n+8;if(typeof e=="object"){let a=Object.keys(e).sort();for(let y of a){let t=e[y];t instanceof Int8Array||I in t?(t[r]=i.getInt8(n),n+=1):t instanceof Uint8Array||f in t?(t[r]=i.getUint8(n),n+=1):t instanceof Int16Array||R in t?(t[r]=i.getInt16(n),n+=2):t instanceof Uint16Array||d in t?(t[r]=i.getUint16(n),n+=2):t instanceof Int32Array||U in t?(t[r]=i.getInt32(n),n+=4):t instanceof Uint32Array||A in t?(t[r]=i.getUint32(n),n+=4):t instanceof Float32Array||v in t?(t[r]=i.getFloat32(n),n+=4):(t[r]=i.getFloat64(n),n+=8)}}return n}var Ae=(e,r,i,n=new ArrayBuffer(1024*1024*100))=>{let a=new DataView(n),y=0,t=[],o=new Map;return C(e,P(r),l=>{t.push([l,0,-1])}),C(e,j(r),l=>{t.push([l,1,-1]),o.delete(l)}),i.forEach((l,s)=>{ce(l)?(C(e,P(r,l(G)),u=>{let c=pe(e,u,l);for(let m of c){o.has(u)||o.set(u,new Map),o.get(u).has(s)||o.get(u).set(s,new Set),o.get(u).get(s).add(m);let p=l(m);t.push([u,4,s,m,p])}}),C(e,j(r,l(G)),u=>{let c=o.get(u);if(c){let m=c.get(s);if(m){for(let p of m)t.push([u,5,s,p]);c.delete(s),c.size===0&&o.delete(u)}}})):(C(e,P(r,l),u=>{t.push([u,2,s])}),C(e,j(r,l),u=>{t.push([u,3,s])}))}),()=>{y=0;for(let l=0;l<t.length;l++){let[s,u,c,m,p]=t[l];a.setUint32(y,s),y+=4,a.setUint8(y,u),y+=1,(u===2||u===3||u===4||u===5)&&(a.setUint8(y,c),y+=1,(u===4||u===5)&&(a.setUint32(y,m),y+=4,u===4&&p&&(y=me(p,s,a,y))))}return t.length=0,n.slice(0,y)}},ge=(e,r,i,n)=>{let a=n||new Map;return(y,t)=>{let o=t||a,l=new DataView(y),s=0;for(;s<y.byteLength;){let u=l.getUint32(s);s+=4;let c=l.getUint8(s);s+=1;let m=-1,p=-1;(c===2||c===3||c===4||c===5)&&(m=l.getUint8(s),s+=1,(c===4||c===5)&&(p=l.getUint32(s),s+=4));let g=i[m],b=o.get(u);if(c===0)b===void 0?(b=ye(e),o.set(u,b),M(e,b,r)):console.warn(`Attempted to deserialize addEntity with ID ${u}, but it has already been deserialzied and exists in the mapping.`);else if(b!==void 0&&ue(e,b)){if(c===1)le(e,b),o.delete(u);else if(c===2)M(e,b,g);else if(c===3)q(e,b,g);else if(c===4){let D=o.get(p);if(D!==void 0){let z=g(D);M(e,b,z),s=be(z,b,l,s)}}else if(c===5){let D=o.get(p);D!==void 0&&q(e,b,g(D))}}}return o}};export{ge as createObserverDeserializer,Ae as createObserverSerializer,se as createSnapshotDeserializer,ae as createSnapshotSerializer,F as createSoADeserializer,B as createSoASerializer,Y as f32,Z as f64,N as i16,X as i32,J as i8,K as u16,Q as u32,H as u8};
//# sourceMappingURL=index.min.mjs.map
